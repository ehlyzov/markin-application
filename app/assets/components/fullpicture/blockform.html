<!--
  = require paper-dialog/paper-dialog
  = require paper-button/paper-button
  = require paper-radio-button/paper-radio-button
  = require paper-radio-group/paper-radio-group
  = require paper-checkbox/paper-checkbox
  = require paper-input/paper-input
-->
<polymer-element name="fp-blockform" attributes="object">
  <template>
    <style>
      :host paper-dialog {
        /*z-index: 1100;*/
      }

      paper-dialog .hint {
        width: 50%;
        position: relative;
        top: -18px;
        font-style: italic;
      }
    </style>

    <paper-dialog id="dialog" heading="{{'manage.content_blocks.editing' | t}}" autoCloseDisabled layered on-core-overlay-open="{{onPaperDialogOpen}}">
      <form>
        <lib-input-radiogroup name="content_block.block_style" value="{{object.block_style}}"></lib-input-radiogroup>

        <template if="{{object.block_style == 'text'}}">
          <label>{{'activerecord.attributes.content_block.text' | t}}</label><br>
          <lib-layout modules="2">
            <template repeat="{{text in object.text_attributes}}">
              <lib-layout-cell width="1">
                <lib-input-text name="{{'content_block.text_attributes.' + text.locale}}"
                  value="{{text.text}}"
                  labelText="{{'locale.' + text.locale | t}}"
                  floatingLabel="true">
                </lib-input-text>
              </lib-layout-cell>
            </template>
          </lib-layout>
        </template>

        <template if="{{object.block_style == 'image'}}">
          <lib-input-uploadcare name="content_block.image" value="{{object.image}}"></lib-input-uploadcare>
        </template>

        <template if="{{object.block_style == 'embed'}}">
          <lib-input-text name="content_block.embed_code" value="{{object.embed_code}}" floatingLabel="true"></lib-input-text>
        </template>

        <lib-input-boolean name="content_block.padding" value="{{object.padding}}"></lib-input-boolean>

        <lib-input-boolean name="content_block.stretch_height" value="{{object.stretch_height}}"></lib-input-boolean>
        
        <lib-input-radiogroup name="content_block.border_style" value="{{object.border_style}}"></lib-input-radiogroup>
        
        <lib-input-radiogroup name="content_block.background_style" value="{{object.background_style}}"></lib-input-radiogroup>

      </form>
      <paper-button label="{{'actions.close' | t }}" affirmative></paper-button>
      
    </paper-dialog>
  </template>
  <script>
    Polymer('fp-blockform', _.extend({
      created: function(){
        if (!this.object)
          this.object = {}
      },
      open: function(){
        document.querySelectorAll('html /deep/ fp-blockform').array().forEach(function(form){
          if (form.$.dialog.opened)
            form.close()
        })
        this.$.dialog.opened = true
        // this.async(function(){
        //   this.$.dialog.$.overlay.updateTargetDimensions()
        // }.bind(this))
      },

      close: function() {
        this.$.dialog.opened = false
        this.fire('fp-blockform-close')
      },

      onPaperDialogOpen: function(event, opened){
        if (opened != true) // the `!=` is important
          this.close()
      }
    }, lib.I18n));
  </script>
</polymer-element>
